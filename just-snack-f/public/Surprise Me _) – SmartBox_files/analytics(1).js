!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};var t=function(){return(t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function c(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(a,c)}s((n=n.apply(e,t||[])).next())}))}function n(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function o(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function i(e){return this instanceof i?(this.v=e,this):new i(e)}var a=Object.freeze({__proto__:null,__extends:function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},get __assign(){return t},__rest:function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r},__decorate:function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},__param:function(e,t){return function(r,n){t(r,n,e)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:r,__generator:function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},__exportStar:function(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])},__values:n,__read:o,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n},__await:i,__asyncGenerator:function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),a=[];return n={},c("next"),c("throw"),c("return"),n[Symbol.asyncIterator]=function(){return this},n;function c(e){o[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=o[e](t)).value instanceof i?Promise.resolve(r.value.v).then(u,d):l(a[0][2],r)}catch(e){l(a[0][3],e)}var r}function u(e){s("next",e)}function d(e){s("throw",e)}function l(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}},__asyncDelegator:function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:i(e[n](t)),done:"return"===n}:o?o(t):t}:o}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=n(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,o,(t=e[r](t)).done,t.value)}))}}},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}}});const c="0.1.0",s=new RegExp("v0.1/analytics.js$"),u="//d2wy8f7a9ursnm.cloudfront.net/v6/bugsnag.min.js",d="8c99c9a3050de729b74948931f71f72e";function l(e){if(0===e.stacktrace.length)return!1;e.updateMetaData("debugStacktrace",{files:e.stacktrace.map(e=>e.file),filter:s.toString()}),e.app.version=c;const t=e.stacktrace.filter(e=>!/native code/.test(e.file));return 0!==t.length&&!!s.test(t[0].file)}let f;function p(){return r(this,void 0,void 0,(function*(){if(f)return f;const e=yield new Promise((e,t)=>{if(window.bugsnag)return void e(window.bugsnag);const r=document.createElement("script");r.onload=()=>{window.bugsnag||t(new Error("No window.bugsnag after bugsnag was loaded")),e(window.bugsnag)},r.onerror=()=>{document.head.removeChild(r),t(new Error("Failed to load bugsnag"))},r.setAttribute("src",u),document.head.appendChild(r)});return f=e({apiKey:d,consoleBreadcrumbsEnabled:!1,beforeSend:l})}))}const h={client:null,initialize(){return r(this,void 0,void 0,(function*(){this.client=yield p()}))},notify(e,t="error"){if(null===this.client)throw new Error("Client not initialized before notify");this.client.notify(e,{severity:t})}};function y(e){!function(e){"loading"!==document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",()=>{"loading"!==document.readyState&&e()})}(()=>{const t=window.ShopifyAnalytics;t&&t.lib&&t.lib.ready(()=>{e()})})}const v=[];function m(e){return v.indexOf(e)}function _(e,t){Array.prototype.slice.apply(document.querySelectorAll(e)).forEach(e=>{-1===v.indexOf(e)&&(v.push(e),t(e))})}function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function w(e,t){return e(t={exports:{}},t.exports),t.exports}var b=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEVELOPMENT_DOMAIN="http://localhost:8082",t.PRODUCTION_DOMAIN="https://monorail-edge.shopifysvc.com",t.PRODUCE_BATCH_ENDPOINT="/unstable/produce_batch",t.PRODUCE_ENDPOINT="/v1/produce",t.PRODUCTION_CANADA_ENDPOINT="https://monorail-edge-ca.shopifycloud.com/v1/produce",t.extractDomain=function(e){return"https://"+new URL(e).hostname}}));g(b);b.DEVELOPMENT_DOMAIN,b.PRODUCTION_DOMAIN,b.PRODUCE_BATCH_ENDPOINT,b.PRODUCE_ENDPOINT,b.PRODUCTION_CANADA_ENDPOINT,b.extractDomain;for(var E=w((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}})),T=[],O=0;O<256;++O)T[O]=(O+256).toString(16).substr(1);var M,P,I=function(e,t){var r=t||0,n=T;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")},S=0,k=0;var C=function(e,t,r){var n=t&&r||0,o=t||[],i=(e=e||{}).node||M,a=void 0!==e.clockseq?e.clockseq:P;if(null==i||null==a){var c=E();null==i&&(i=M=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=P=16383&(c[6]<<8|c[7]))}var s=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:k+1,d=s-S+(u-k)/1e4;if(d<0&&void 0===e.clockseq&&(a=a+1&16383),(d<0||s>S)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");S=s,k=u,P=a;var l=(1e4*(268435455&(s+=122192928e5))+u)%4294967296;o[n++]=l>>>24&255,o[n++]=l>>>16&255,o[n++]=l>>>8&255,o[n++]=255&l;var f=s/4294967296*1e4&268435455;o[n++]=f>>>8&255,o[n++]=255&f,o[n++]=f>>>24&15|16,o[n++]=f>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(var p=0;p<6;++p)o[n+p]=i[p];return t||I(o)};var j=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||E)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[n+i]=o[i];return t||I(o)},D=j;D.v1=C,D.v4=j;var x=D,R=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(r){var n=e.call(this,"Error producing to the Monorail Edge. Response received: "+JSON.stringify(r))||this;return n.response=r,Object.setPrototypeOf(n,t.prototype),n}return a.__extends(t,e),t}(Error);t.MonorailUnableToProduceError=r;var n=function(e){function t(r){var n=e.call(this,"Error producing to the Monorail Edge. Response received: "+JSON.stringify(r))||this;return Object.setPrototypeOf(n,t.prototype),n.response=r,n}return a.__extends(t,e),t}(Error);t.MonorailBatchProduceError=n;var o=function(e){function t(r){var n=e.call(this,"Error completing request. A network failure may have prevented the request from completing. Error: "+r)||this;return Object.setPrototypeOf(n,t.prototype),n}return a.__extends(t,e),t}(Error);t.MonorailRequestError=o;var i=function(e){function t(r){var n=e.call(this,""+r)||this;return Object.setPrototypeOf(n,t.prototype),n}return a.__extends(t,e),t}(Error);t.MonorailRetriesExceededError=i}));g(R);R.MonorailUnableToProduceError,R.MonorailBatchProduceError,R.MonorailRequestError,R.MonorailRetriesExceededError;var A=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=b.DEVELOPMENT_DOMAIN),this.edgeDomain=e}return e.withEndpoint=function(t){return new e(b.extractDomain(t))},e.getHeadersFromMetadata=function(e){var t={"Content-Type":"application/json; charset=utf-8","X-Monorail-Edge-Event-Created-At-Ms":(e&&e.eventCreatedAtMs||Date.now()).toString(),"X-Monorail-Edge-Event-Sent-At-Ms":Date.now().toString(),"X-Monorail-Edge-Client-Message-Id":(e&&e.clientMessageId||x.v4()).toString()};return e&&e.userAgent&&(t["User-Agent"]=e.userAgent),t},e.prototype.produceBatch=function(t){return a.__awaiter(this,void 0,void 0,(function(){var r,n,o,i,c,s;return a.__generator(this,(function(a){switch(a.label){case 0:r={events:this.convertAllEventsToUnderscoreCase(t),metadata:this.toUnderscoreCase(t.metadata)},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch(this.produceBatchEndpoint(),{method:"post",headers:e.getHeadersFromMetadata(t.metadata),body:JSON.stringify(r)})];case 2:return n=a.sent(),[3,4];case 3:throw o=a.sent(),new R.MonorailRequestError(o);case 4:return 207!==n.status?[3,6]:[4,n.json()];case 5:throw i=a.sent(),new R.MonorailBatchProduceError(i);case 6:return n.ok?[3,8]:(c=R.MonorailUnableToProduceError.bind,s={status:n.status},[4,n.text()]);case 7:throw new(c.apply(R.MonorailUnableToProduceError,[void 0,(s.message=a.sent(),s)]));case 8:return[2,{status:n.status}]}}))}))},e.prototype.produce=function(t){return a.__awaiter(this,void 0,void 0,(function(){var r,n,o,i,c;return a.__generator(this,(function(a){switch(a.label){case 0:r={schema_id:t.schemaId,payload:this.toUnderscoreCase(t.payload)},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch(this.produceEndpoint(),{method:"post",headers:e.getHeadersFromMetadata(t.metadata),body:JSON.stringify(r)})];case 2:return n=a.sent(),[3,4];case 3:throw o=a.sent(),new R.MonorailRequestError(o);case 4:if(!n)throw new R.MonorailUnableToProduceError({message:"No response from edge"});return n.ok?[3,6]:(i=R.MonorailUnableToProduceError.bind,c={status:n.status},[4,n.text()]);case 5:throw new(i.apply(R.MonorailUnableToProduceError,[void 0,(c.message=a.sent(),c)]));case 6:return[2,{status:n.status}]}}))}))},e.prototype.produceBatchEndpoint=function(){return this.edgeDomain+b.PRODUCE_BATCH_ENDPOINT},e.prototype.produceEndpoint=function(){return this.edgeDomain+b.PRODUCE_ENDPOINT},e.prototype.convertAllEventsToUnderscoreCase=function(e){var t=this;return e.events.map((function(e){return{schema_id:e.schemaId,payload:t.toUnderscoreCase(e.payload),metadata:t.toUnderscoreCase(e.metadata)}}))},e.prototype.toUnderscoreCase=function(e){var t=this;return e?Object.keys(e).map((function(r){var n;return(n={})[t.convertStringToUnderscoreCase(r)]=e[r],n})).reduce((function(e,t){return a.__assign({},e,t)})):e},e.prototype.convertStringToUnderscoreCase=function(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()},e}();t.HttpProducer=r}));g(A);A.HttpProducer;var N=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){this.sendToConsole=t,t&&e.printWelcomeMessage(t)}return e.printWelcomeMessage=function(e){console.log("%cðŸ‘‹ from Monorail%c\n\nWe've noticed that you're"+(e?"":" not")+" running in debug mode. As such, we will "+(e?"produce":"not produce")+" Monorail events to the console. \n\nIf you want Monorail events to "+(e?"stop":"start")+" appearing here, %cset debugMode="+(!e).toString()+"%c, for the Monorail Log Producer in your code.","font-size: large;","font-size: normal;","font-weight: bold;","font-weight: normal;")},e.prototype.produce=function(e){return this.sendToConsole&&console.log("Monorail event produced",e),new Promise((function(t){t(e)}))},e.prototype.produceBatch=function(e){return this.sendToConsole&&console.log("Monorail Batch event produced",e),new Promise((function(t){t(e)}))},e}();t.LogProducer=r}));g(N);N.LogProducer;var U=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isCompositeMonorailEvent=function(e){return void 0!==e.schemaId}}));g(U);U.isCompositeMonorailEvent;var L=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.producer=e}return e.prototype.do=function(e,t){return U.isCompositeMonorailEvent(e)?this.producer.produce(e):this.producer.produceBatch(e)},e}();t.ProducerMiddleware=r}));g(L);L.ProducerMiddleware;var q=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,r){this.producer=t,this.middleware=r,this.executeChain=e.buildMiddlewareChain(this.middleware.concat(new L.ProducerMiddleware(t)))}return e.createLogProducer=function(t){return new e(new N.LogProducer(t.debugMode),t.middleware||[])},e.createHttpProducerWithEndpoint=function(t,r){return void 0===r&&(r=[]),new e(A.HttpProducer.withEndpoint(t),r)},e.createHttpProducer=function(t){return new e(t.production?new A.HttpProducer(b.PRODUCTION_DOMAIN):new A.HttpProducer(b.DEVELOPMENT_DOMAIN),t.middleware||[])},e.buildMiddlewareChain=function(e,t){var r=this;return void 0===t&&(t=0),t===e.length?this.identityFn:function(n){return e[t].do(n,r.buildMiddlewareChain(e,t+1))}},e.prototype.produce=function(e){return e.metadata=a.__assign({eventCreatedAtMs:Date.now(),clientMessageId:x.v4()},e.metadata),this.executeChain(e)},e.prototype.produceBatch=function(e){return this.executeChain(e)},e}();t.Monorail=r}));g(q);q.Monorail;var V=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=3),void 0===t&&(t=150),this.maxRetries=e,this.delayMs=t}return e.prototype.do=function(e,t){return a.__awaiter(this,void 0,void 0,(function(){var r,n,o,i,c;return a.__generator(this,(function(a){switch(a.label){case 0:r=0,a.label=1;case 1:if(!(r<this.maxRetries))return[3,7];o=void 0,a.label=2;case 2:return a.trys.push([2,4,,6]),[4,t(e)];case 3:return o=a.sent(),[3,6];case 4:if(i=a.sent(),n=n||new Error,n=new Error(n.message+" Retry count:"+(r+1)+" Error msg:"+i.message+"\n"),i instanceof R.MonorailUnableToProduceError&&(c=i.response.status)&&c>=400&&c<500)throw i;return[4,this.delay(this.delayMs*Math.pow(2,r))];case 5:return a.sent(),r++,[3,1];case 6:return[2,o];case 7:throw n?n.message="Retry count of "+this.maxRetries+" exceeded. Failed with error: \n"+n.message+" Aborting request for "+JSON.stringify(e):n=new Error,new R.MonorailRetriesExceededError(n)}}))}))},e.prototype.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},e}();t.RetryMiddleware=r}));g(V);V.RetryMiddleware;var H=w((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Monorail=q.Monorail,t.MonorailRequestError=R.MonorailRequestError,t.MonorailUnableToProduceError=R.MonorailUnableToProduceError,t.MonorailRetriesExceededError=R.MonorailRetriesExceededError,t.RetryMiddleware=V.RetryMiddleware}));g(H);var B=H.Monorail,F=(H.MonorailRequestError,H.MonorailUnableToProduceError,H.MonorailRetriesExceededError,H.RetryMiddleware);function z(){return window.location.href}function J(){const{resourceType:e=null,resourceId:t=null}=function(){try{return window.ShopifyAnalytics.meta.page}catch(e){return null}}()||{};return{resourceType:e,resourceId:t}}let W=null;const X='script#shopify-features[type="application/json"]';function G(){if(!W){const e=document.head.querySelector(X)||document.querySelector(X);if(!e)return null;W=JSON.parse(e.innerHTML).shopId}return W}function K(){try{return window.ShopifyAnalytics.lib.user().traits().uniqToken}catch(e){return null}}function Z(){try{return window.ShopifyAnalytics.lib.trekkie.defaultAttributes.visitToken}catch(e){return null}}let $,Q;function Y(){if($)return Object.assign(Object.assign({},$),{pageUrl:z()});const{resourceId:e,resourceType:t}=J();return $={shopId:G(),uniqToken:K(),sessionToken:Z(),pageUrl:z(),resourceType:t,resourceId:e}}var ee=Q=B.createHttpProducer({production:!0,middleware:[new F(5,200)]});const te={trackCreated(e){const t=Y();return ee.produce({schemaId:"online_store_media_ar_created/1.0",payload:Object.assign(Object.assign({},t),e)})},trackInvoke(e){const t=Y();return ee.produce({schemaId:"online_store_media_ar_invoked/1.0",payload:Object.assign(Object.assign({},t),e)})}},re="html_anchor",{trackCreated:ne,trackInvoke:oe}=te;let ie=0;function ae({anchor:e,arElementType:t}){const r=ie++,n=e.href||"";e.addEventListener("click",(function(){oe({src:n,sessionSourceId:r,invoker:re,arType:t})})),ne({arElementType:t,sessionSourceId:r,src:n})}const ce='a[rel="ar"]';y((function(){_(ce,e=>{ae({anchor:e,arElementType:"ar_quicklook"})})}));const se='a[href*="package=com.google.ar.core;action=android.intent.action.VIEW;"]';y((function(){_(se,e=>{ae({anchor:e,arElementType:"scene_viewer"})})}));const ue={trackCreated(e){const t=Y();return ee.produce({schemaId:"online_store_media_model_viewer_created/1.0",payload:Object.assign(Object.assign({},t),e)})},trackLoaded(e){const t=Y();return ee.produce({schemaId:"online_store_media_model_viewer_loaded/1.0",payload:Object.assign(Object.assign({},t),e)})},trackFailed(e){const t=Y();return ee.produce({schemaId:"online_store_media_model_viewer_failed/1.0",payload:Object.assign(Object.assign({},t),e)})},trackInteract(e){const t=Y();return ee.produce({schemaId:"online_store_media_model_viewer_interact/1.0",payload:Object.assign(Object.assign({},t),e)})}};let de=0;const le="model-viewer";y((function(){_(le,e=>{!function({modelViewer:e,trackCreated:t,trackLoaded:r,trackFailed:n,trackInteract:o}){const i=de++;let a=e.src||"",c=e.iosSrc,s=Date.now(),u=!1;t({sessionModelViewerId:i,src:a,iosSrc:c}),e.addEventListener("load",(function(){r({sessionModelViewerId:i,src:a,timeToLoaded:(Date.now()-s)/1e3})})),e.addEventListener("error",(function(e){const t=e.detail.type;n({sessionModelViewerId:i,src:a,type:t})})),e.addEventListener("camera-change",(function(e){u||"user-interaction"===e.detail.source&&(u=!0,o({sessionModelViewerId:i,src:a}))})),e.addEventListener("progress",(function(){e.src!==a&&(a=e.src||"",u=!1,s=Date.now())}))}(Object.assign({modelViewer:e},ue))})}));const{trackCreated:fe,trackInvoke:pe}=te,he=function(){_("[data-shopify-xr]:not([data-shopify-xr-hidden])",e=>{e.hasAttribute("data-shopify-xr-hidden")||fe({arElementType:"shopify_xr",sessionSourceId:m(e),src:"unknown"})})};document.addEventListener("shopify_xr_launch",e=>{const{xrMode:t,srcUrl:r,element:n}=e.detail;let o=null;"not_supported"!==t&&(n&&(o=m(n)),-1!==o&&pe({arType:t,invoker:"shopify_xr",sessionSourceId:o,src:r}))}),document.addEventListener("shopify_xr_enabled",e=>{he()}),y((function(){he()}));const ye={trackCreated(e){const t=Y();return ee.produce({schemaId:"online_store_media_video_created/4.0",payload:Object.assign(Object.assign({},t),e)})},trackCanPlay(e){const t=Y();return ee.produce({schemaId:"online_store_media_video_canplay/3.0",payload:Object.assign(Object.assign({},t),e)})},trackProgress(e){const t=Y();return ee.produce({schemaId:"online_store_media_video_progress/3.0",payload:Object.assign(Object.assign({},t),e)})}};class ve{constructor({videoDuration:e,startTime:t,endTime:r}){this.videoDuration=e,this._startTime=t,this._endTime=r,r||(this._endTime=t)}get startTime(){return this._startTime}get endTime(){return this._endTime}get percentage(){return(this._endTime-this._startTime)/this.videoDuration}isTimeInSegment(e){return e>=this._startTime&&e<=this._endTime}extendSegment(e){return e<this._startTime?(this._startTime=e,!0):e>this._endTime&&(this._endTime=e,!0)}}function me(e){const t=[new ve({videoDuration:e,startTime:0})];let r=t[0];function n(e){for(let r=0;r<t.length;r++)if(t[r].isTimeInSegment(e))return t[r];return null}return{get percentage(){return 0===t.length?0:t.reduce((e,t)=>e+t.percentage,0)},seek(o){let i=n(o);if(!i)return r=new ve({videoDuration:e,startTime:o}),void t.push(r);r=i},addTime(o){let i=n(o);i&&i!==r&&(r=function(r,n){for(let e=t.length-1;e>=0;e--)t[e]!==r&&t[e]!==n||t.splice(e,1);const o=r.startTime<n.startTime?r.startTime:n.startTime,i=r.endTime>n.endTime?r.endTime:n.endTime,a=new ve({videoDuration:e,startTime:o,endTime:i});return t.push(a),a}(i,r)),r.extendSegment(o)}}}const _e=[1e3,2e3,3e3,5e3,7e3],ge=3,we="progress",be="canplay",Ee=!0,Te="html_video",Oe="cdn.shopify.com/videos";let Me=0;function Pe({video:e,trackCreated:t,trackCanPlay:r,trackProgress:n}){const o=Me++;let i,a,c=-1,s=-1,u=0;function d(t=!1){if(!a)return;a.addTime(e.currentTime),(e.currentTime>=e.duration||t||!function(){const e=_e.length,t=Math.min(u,e-1);return Date.now()-c<_e[t]}())&&s!==e.currentTime&&(n({currentSrc:e.currentSrc,time:e.currentTime,duration:e.duration,percentageWatched:a.percentage,sessionVideoId:o,videoType:Te}),u+=1,s=e.currentTime,c=Date.now(),1==a.percentage&&(e.removeEventListener("timeupdate",y),e.removeEventListener("seeked",h)))}function l(){void 0===i&&(i=Date.now())}function f(){l(),e.removeEventListener(we,f)}function p(){l(),a=me(e.duration),e.removeEventListener(be,p),r({currentSrc:e.currentSrc,timeToCanplay:(Date.now()-i)/1e3,sessionVideoId:o,videoType:Te})}function h(){a.seek(e.currentTime)}function y(){d()}e.currentSrc?t({currentSrc:e.currentSrc,sessionVideoId:o,canTrack:Ee,videoType:Te}):e.addEventListener("loadstart",()=>{t({currentSrc:e.currentSrc,sessionVideoId:o,canTrack:Ee,videoType:Te})}),function(e){return e.currentSrc&&e.currentSrc.includes(Oe)}(e)&&(e.addEventListener("seeked",h),e.addEventListener("timeupdate",y),window.addEventListener("beforeunload",()=>{d(!0)}),e.readyState<ge?(e.addEventListener(we,f),e.addEventListener(be,p)):(f(),p()))}const Ie="video";y((function(){_(Ie,e=>{Pe(Object.assign({video:e},ye))})}));const Se="youtube",ke={trackCreated(e){const t=Y();return ee.produce({schemaId:"online_store_media_video_created/4.0",payload:Object.assign(Object.assign({},t),e)})}};let Ce=0;function je({videoType:e,querySelector:t,determineCanTrack:r}){_(t,t=>{const n=t;let o=!0;r&&(o=r(n)),function({videoType:e,videoIframe:t,trackCreated:r,canTrack:n}){const o=Ce++;r({currentSrc:t.src,sessionVideoId:o,canTrack:n,videoType:e})}(Object.assign({videoType:e,videoIframe:n,canTrack:o},ke))})}const De='iframe[src^="https://www.youtube.com/embed/"]';y((function(){je({querySelector:De,videoType:Se,determineCanTrack(e){return!!(t=e.src)&&t.split("?").pop().includes("enablejsapi=1");var t}})}));const xe="vimeo",Re='iframe[src^="https://player.vimeo.com/video/"]';y((function(){je({querySelector:Re,videoType:xe})})),function(){r(this,void 0,void 0,(function*(){try{yield h.initialize()}catch(e){throw e}}))}()}();
//# sourceMappingURL=analytics.js.map
